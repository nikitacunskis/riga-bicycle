import{r as d,c as V,k as j,o as i,e as u,b as e,F as P,f as C,n as z,t as g,d as h,j as B,a as R,w as S,i as I,l as q,m as f,v as A,p as E,h as U,q as D}from"./app.ff9256fe.js";import{_ as K}from"./AdminLayout.fa9b63d2.js";import{_ as F}from"./BodySection.c501a4dc.js";import{_ as H}from"./PrimaryButton.b6cc1c92.js";import"./_plugin-vue_export-helper.cdc0426e.js";const Y={class:"overflow-x-auto shadow-sm"},G=["id"],J={class:"sticky top-0 backdrop-blur z-10"},Q={class:"[&_tr:nth-child(odd)]:bg-gray-50/40"},W={class:"px-4 py-3 text-sm"},X={key:1},Z=["colspan"],ee={class:"mt-4 flex items-center justify-between"},te={class:"text-sm text-gray-500"},ae={class:"font-medium text-gray-700"},le={class:"font-medium text-gray-700"},se={class:"flex items-center gap-3"},oe=["value"],re=["value"],ie={class:"inline-flex items-center gap-1","aria-label":"Pagination"},ne=["disabled"],de=["disabled"],ue={__name:"DashboardTable",props:{items:{type:Array,default:()=>[]},columns:{type:Array,default:()=>[]},pageSizeOptions:{type:Array,default:()=>[5,10,20,50]},defaultPageSize:{type:Number,default:10},tableId:{type:String,default:"dashboard-table"},emptyText:{type:String,default:"No records yet."}},setup(b){const _=b,m=d(_.defaultPageSize),n=d(1),w=V(()=>_.items.length),p=V(()=>Math.max(1,Math.ceil(w.value/m.value))),k=V(()=>{const r=(n.value-1)*m.value;return _.items.slice(r,r+m.value)});function v(r){var l;const s=Math.min(Math.max(1,r),p.value);n.value=s,(l=document==null?void 0:document.getElementById(_.tableId))==null||l.scrollIntoView({behavior:"smooth",block:"start"})}function x(r){m.value=r,n.value=1}return j(()=>_.items.length,()=>{const r=(p.value-1)*m.value;(n.value-1)*m.value>r&&v(p.value)}),(r,s)=>(i(),u("div",null,[e("div",Y,[e("table",{id:b.tableId,class:"min-w-full table-auto text-left"},[e("thead",J,[e("tr",null,[(i(!0),u(P,null,C(b.columns,l=>{var c;return i(),u("th",{key:l.key,class:z(["px-4 py-3 text-xs font-semibold uppercase tracking-wider text-gray-500 text-white",l.thClass])},g((c=l.label)!=null?c:l.key),3)}),128)),s[3]||(s[3]=e("th",{class:"px-4 py-3 text-xs font-semibold uppercase tracking-wider text-gray-500 text-white"},"Actions",-1))])]),e("tbody",Q,[k.value.length?(i(!0),u(P,{key:0},C(k.value,l=>(i(),u("tr",{key:l.id},[(i(!0),u(P,null,C(b.columns,c=>{var y;return i(),u("td",{key:c.key,class:z(["px-4 py-3 text-sm text-white",c.class])},[c.format?(i(),u(P,{key:0},[h(g(c.format(l[c.key],l)),1)],64)):(i(),u(P,{key:1},[h(g((y=l[c.key])!=null?y:"\u2014"),1)],64))],2)}),128)),e("td",W,[B(r.$slots,"actions",{row:l})])]))),128)):(i(),u("tr",X,[e("td",{colspan:b.columns.length+1,class:"px-4 py-8 text-center text-sm text-gray-500"},g(b.emptyText),9,Z)]))])],8,G)]),e("div",ee,[e("div",te,[s[4]||(s[4]=h(" Page ",-1)),e("span",ae,g(n.value),1),s[5]||(s[5]=h(" of ",-1)),e("span",le,g(p.value),1)]),e("div",se,[s[6]||(s[6]=e("label",{class:"text-sm text-gray-500"},"Rows per page:",-1)),e("select",{class:"border border-gray-300 px-2 py-1 text-sm shadow-sm bg-black",value:m.value,onChange:s[0]||(s[0]=l=>x(Number(l.target.value)))},[(i(!0),u(P,null,C(b.pageSizeOptions,l=>(i(),u("option",{key:l,value:l},g(l),9,re))),128))],40,oe),e("nav",ie,[e("button",{class:"border border-gray-300 px-3 py-2 text-sm shadow-sm",disabled:n.value===1,onClick:s[1]||(s[1]=l=>v(n.value-1))},"\u2039 Prev",8,ne),e("button",{class:"border border-gray-300 px-3 py-2 text-sm shadow-sm",disabled:n.value===p.value,onClick:s[2]||(s[2]=l=>v(n.value+1))},"Next \u203A",8,de)])])])]))}},ce={class:"mb-4 border border-gray-200 p-4 bg-white/60 dark:bg-gray-900/40"},me={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},pe={class:"flex flex-col"},ve={class:"flex flex-col"},be={key:0,class:"flex flex-col"},xe={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},ye={class:"flex flex-col"},fe={class:"flex flex-col"},ge={class:"flex items-end"},ke=["aria-expanded"],he={key:0,class:"grid grid-cols-1 md:grid-cols-3 gap-3"},we={class:"flex flex-col"},_e={class:"flex flex-col"},$e=["min"],Pe={class:"flex flex-col md:flex-row md:items-center gap-3"},Ae={class:"inline-flex items-center gap-2 text-sm"},Se={class:"inline-flex items-center gap-2 text-sm"},Ce={class:"ml-auto"},Ve={key:0,class:"mt-3 border border-emerald-300 bg-emerald-50 p-3 text-sm text-emerald-900"},Ie={class:"flex items-center gap-2"},Ue=["value"],ze=["onClick"],je={__name:"List",props:{apis:{type:Array,default:()=>[]}},setup(b){const m=d([...b.apis]),n=d(""),w=d(""),p=d(""),k=d(""),v=d(""),x=d("personal"),r=d(""),s=d(!1),l=d(!1),c=d(!1),y=d(null),$=d(!1);function N(a){return a?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a):!0}async function T(){if(!n.value.trim())return alert("Owner is required.");if(!s.value||!l.value)return alert("You must accept Terms of Service and Privacy Policy.");if(!N(v.value.trim()))return alert("Invalid email format.");if(x.value==="organisation"&&!r.value.trim())return alert("Registration number is required for organisation type.");c.value=!0;try{const a={owner:n.value.trim(),type:x.value,tos_accepted:!0,privacy_accepted:!0};w.value.trim()&&(a.key=w.value.trim()),p.value&&(a.valid_until=p.value),k.value.trim()&&(a.phone=k.value.trim()),v.value.trim()&&(a.email=v.value.trim()),x.value==="organisation"&&r.value.trim()&&(a.reg_number=r.value.trim());const{data:t}=await window.axios.post("http://localhost:8080/dashboard/apis/store",a,{headers:{Accept:"application/json"}});m.value.unshift(t.api),y.value=t.api.key,n.value="",w.value="",p.value="",k.value="",v.value="",x.value="personal",r.value="",s.value=!1,l.value=!1,$.value=!1}catch(a){console.error(a),alert("Failed to create API key.")}finally{c.value=!1}}function M(){var a;!y.value||((a=navigator.clipboard)==null||a.writeText(y.value),y.value=null)}async function O(a){if(!!confirm("Delete this API key?"))try{await window.axios.delete(`/dashboard/apis/${a}`,{headers:{Accept:"application/json"}}),m.value=m.value.filter(t=>t.id!==a)}catch(t){console.error(t),alert("Delete failed.")}}const L=[{key:"id",label:"ID"},{key:"key",label:"Key"},{key:"owner",label:"Owner"},{key:"type",label:"Type",format:a=>a||"\u2014"},{key:"reg_number",label:"Reg #",format:a=>a||"\u2014"},{key:"email",label:"Email",format:a=>a||"\u2014"},{key:"phone",label:"Phone",format:a=>a||"\u2014"},{key:"valid_until",label:"Valid Until",format:a=>a?new Date(a).toLocaleDateString():"\u2014"}];return(a,t)=>(i(),R(K,{title:"API keys"},{header:S(()=>[...t[10]||(t[10]=[e("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"API keys",-1)])]),default:S(()=>[I(F,null,{default:S(()=>[e("div",ce,[e("form",{onSubmit:q(T,["prevent"]),class:"flex flex-col gap-4"},[e("div",me,[e("div",pe,[t[11]||(t[11]=e("label",{class:"text-xs text-gray-500 mb-1"},[h("Owner"),e("span",{class:"text-red-500"},"*")],-1)),f(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>n.value=o),required:"",placeholder:"Person or organization",class:"border-gray-300 text-sm shadow-sm focus:border-black p-2 focus:ring-black bg-black"},null,512),[[A,n.value]])]),e("div",ve,[t[13]||(t[13]=e("label",{class:"text-xs text-gray-500 mb-1"},"Type",-1)),f(e("select",{"onUpdate:modelValue":t[1]||(t[1]=o=>x.value=o),class:"border-gray-300 text-sm shadow-sm focus:border-black p-2 focus:ring-black bg-black"},[...t[12]||(t[12]=[e("option",{value:"personal"},"personal",-1),e("option",{value:"organisation"},"organisation",-1)])],512),[[E,x.value]])]),x.value==="organisation"?(i(),u("div",be,[t[14]||(t[14]=e("label",{class:"text-xs text-gray-500 mb-1"},"Registration Number",-1)),f(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>r.value=o),placeholder:"e.g. LV12345678901",class:"border-gray-300 text-sm shadow-sm focus:border-black p-2 focus:ring-black bg-black"},null,512),[[A,r.value]])])):U("",!0)]),e("div",xe,[e("div",ye,[t[15]||(t[15]=e("label",{class:"text-xs text-gray-500 mb-1"},"Email",-1)),f(e("input",{type:"email","onUpdate:modelValue":t[3]||(t[3]=o=>v.value=o),placeholder:"name@example.com",class:"border-gray-300 text-sm shadow-sm focus:border-black p-2 focus:ring-black bg-black"},null,512),[[A,v.value]])]),e("div",fe,[t[16]||(t[16]=e("label",{class:"text-xs text-gray-500 mb-1"},"Phone",-1)),f(e("input",{type:"tel","onUpdate:modelValue":t[4]||(t[4]=o=>k.value=o),placeholder:"+371 20000000",class:"border-gray-300 text-sm shadow-sm focus:border-black p-2 focus:ring-black bg-black"},null,512),[[A,k.value]])]),e("div",ge,[e("button",{type:"button",class:"text-sm underline text-gray-600 hover:text-gray-900",onClick:t[5]||(t[5]=o=>$.value=!$.value),"aria-expanded":$.value.toString()},g($.value?"Hide advanced":"Advanced"),9,ke)])]),$.value?(i(),u("div",he,[e("div",we,[t[17]||(t[17]=e("label",{class:"text-xs text-gray-500 mb-1"},"Custom Key (optional)",-1)),f(e("input",{"onUpdate:modelValue":t[6]||(t[6]=o=>w.value=o),placeholder:"Leave empty to auto-generate",class:"border-gray-300 text-sm shadow-sm focus:border-black p-2 focus:ring-black bg-black font-mono"},null,512),[[A,w.value]]),t[18]||(t[18]=e("p",{class:"text-[11px] text-gray-500 mt-1"},"If empty, the server will generate a secure key.",-1))]),e("div",_e,[t[19]||(t[19]=e("label",{class:"text-xs text-gray-500 mb-1"},"Valid Until (optional)",-1)),f(e("input",{type:"date","onUpdate:modelValue":t[7]||(t[7]=o=>p.value=o),min:new Date().toISOString().slice(0,10),class:"border-gray-300 text-sm shadow-sm focus:border-black focus:ring-black bg-black p-2"},null,8,$e),[[A,p.value]]),t[20]||(t[20]=e("p",{class:"text-[11px] text-gray-500 mt-1"},"Default: today + 1 year.",-1))])])):U("",!0),e("div",Pe,[e("label",Ae,[f(e("input",{type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=o=>s.value=o)},null,512),[[D,s.value]]),t[21]||(t[21]=e("span",null,[h("Accept Terms of Service"),e("span",{class:"text-red-500"},"*")],-1))]),e("label",Se,[f(e("input",{type:"checkbox","onUpdate:modelValue":t[9]||(t[9]=o=>l.value=o)},null,512),[[D,l.value]]),t[22]||(t[22]=e("span",null,[h("Accept Privacy Policy"),e("span",{class:"text-red-500"},"*")],-1))]),e("div",Ce,[I(H,{type:"submit",disabled:c.value,class:"h-10"},{default:S(()=>[h(g(c.value?"Creating\u2026":"Create"),1)]),_:1},8,["disabled"])])])],32),y.value?(i(),u("div",Ve,[t[23]||(t[23]=e("div",{class:"font-medium mb-2"},"API key created (shown once)",-1)),e("div",Ie,[e("input",{value:y.value,readonly:"",class:"flex-1 border bg-white font-mono text-[13px] px-2 py-1"},null,8,Ue),e("button",{class:"border px-2 py-1 text-xs hover:bg-emerald-100",onClick:M},"Copy & hide")])])):U("",!0)]),I(ue,{"table-id":"apis-table",items:m.value,columns:L,"default-page-size":10,"page-size-options":[5,10,20,50],"empty-text":"No API keys yet."},{actions:S(({row:o})=>[e("button",{class:"border border-red-300 px-3 py-2 text-sm shadow-sm hover:bg-red-50 text-red-700",onClick:De=>O(o.id)},"Delete",8,ze)]),_:1},8,["items"])]),_:1})]),_:1}))}};export{je as default};
